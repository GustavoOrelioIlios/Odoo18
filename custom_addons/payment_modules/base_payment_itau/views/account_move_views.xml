<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- View para o modelo move.boleto -->
        <record id="view_move_boleto_tree" model="ir.ui.view">
            <field name="name">move.boleto.tree</field>
            <field name="model">move.boleto</field>
            <field name="arch" type="xml">
                <list string="Boletos">
                    <field name="id"/>
                    <field name="data_emissao"/>
                    <field name="data_limite_pagamento"/>
                    <field name="l10n_br_is_barcode"/>
                    <field name="l10n_br_is_barcode_formatted"/>
                </list>
            </field>
        </record>
        
        <!-- Adiciona bot√£o "Emitir Boleto Ita√∫" na view de fatura -->
        <record id="view_move_form_itau_boleto" model="ir.ui.view">
            <field name="name">account.move.form.itau.boleto</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                
                <!-- Adiciona o bot√£o no header, ap√≥s os bot√µes existentes -->
                <xpath expr="//header/button[@name='action_post']" position="after">
                    <button name="action_emitir_boleto_itau" 
                            type="object" 
                            string="üé´ Emitir Boleto Ita√∫" 
                            class="btn-primary" 
                            invisible="state != 'posted' or move_type not in ['out_invoice', 'out_refund']"
                            groups="account.group_account_invoice"/>
                </xpath>
                
                <!-- Adicionar aba "Boleto Ita√∫" -->
                <notebook position="inside">
                    <page string="Boleto Ita√∫" 
                          name="itau_boleto_tab"
                          invisible="move_type not in ('out_invoice', 'out_refund')">
                        
                        <group string="üìä Status da Emiss√£o" col="4">
                            <field name="itau_boleto_status" widget="badge" 
                                   decoration-success="itau_boleto_status == 'success'"
                                   decoration-danger="itau_boleto_status == 'error'"
                                   decoration-muted="itau_boleto_status == 'none'"/>
                            <field name="itau_boleto_date"/>
                            <field name="l10n_br_is_own_number"/>
                            <button name="action_emitir_boleto_itau" 
                                    string="üîÑ Reemitir Boleto" 
                                    type="object" 
                                    class="btn-secondary"
                                    invisible="state != 'posted'"
                                    help="Clique para emitir ou reemitir o boleto Ita√∫"/>
                        </group>
                        
                        <!-- Mensagem de erro, se houver -->
                        <group string="‚ö†Ô∏è Erro na Emiss√£o" invisible="not itau_boleto_error_message">
                            <field name="itau_boleto_error_message" nolabel="1" 
                                   widget="text" readonly="1"
                                   style="color: #dc3545; font-family: monospace; background: #f8d7da; padding: 10px; border-radius: 5px;"/>
                        </group>
                        
                        <!-- Se√ß√£o de JSONs -->
                        <group string="üìã Dados da Comunica√ß√£o com API" invisible="not itau_boleto_json_request and not itau_boleto_json_response">
                            
                            <!-- Subsection para Request -->
                            <group string="üì§ JSON Enviado (Request)" col="1" invisible="not itau_boleto_json_request">
                                <field name="itau_boleto_request_formatted" nolabel="1" 
                                       widget="html"/>
                            </group>
                            
                            <!-- Subsection para Response -->
                            <group string="üì• JSON Recebido (Response)" col="1" invisible="not itau_boleto_json_response">
                                <field name="itau_boleto_response_formatted" nolabel="1" 
                                       widget="html"/>
                            </group>
                            
                        </group>
                        
                        <!-- Se√ß√£o de Boletos Gerados -->
                        <group string="üìã Boletos Gerados" invisible="not boleto_ids">
                            <field name="boleto_ids" nolabel="1" view_mode="tree" views="view_move_boleto_tree,form"/>
                        </group>
                        
                        <!-- Instru√ß√µes caso ainda n√£o tenha sido emitido -->
                        <div invisible="itau_boleto_status != 'none'" 
                             style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3 style="color: #6c757d;">üé´ Emiss√£o de Boleto Ita√∫</h3>
                            <p>Esta fatura ainda n√£o possui boleto emitido.</p>
                            <p>Para emitir um boleto, clique no bot√£o "üé´ Emitir Boleto Ita√∫" no cabe√ßalho da fatura.</p>
                            <hr style="margin: 20px 0; border: 1px solid #dee2e6;"/>
                            <small><strong>Requisitos:</strong></small><br/>
                            <small>‚Ä¢ Fatura deve estar confirmada (estado "Lan√ßada")</small><br/>
                            <small>‚Ä¢ Empresa deve ter configura√ß√£o de API Ita√∫</small><br/>
                            <small>‚Ä¢ Empresa deve ter conta banc√°ria Ita√∫ configurada</small>
                        </div>
                        
                    </page>

                    <!-- Nova aba para Protesto e Negativa√ß√£o -->
                    <page string="Protesto e Negativa√ß√£o" 
                          name="itau_protest_negativation_tab"
                          invisible="move_type not in ('out_invoice', 'out_refund')">
                        
                        <group>
                            <!-- Grupo de Protesto -->
                            <group string="‚öñÔ∏è Protesto" name="protest_group">
                                <field name="itau_protest_code"/>
                                <field name="itau_protest_days" 
                                       invisible="itau_protest_code != '1'"
                                       required="itau_protest_code == '1'"/>
                            </group>
                            
                            <!-- Grupo de Negativa√ß√£o -->
                            <group string="üìù Negativa√ß√£o" name="negativation_group">
                                <field name="itau_negativation_code"/>
                                <field name="itau_negativation_days" 
                                       invisible="itau_negativation_code != '2'"
                                       required="itau_negativation_code == '2'"/>
                            </group>
                        </group>

                        <!-- Grupo de Mensagens -->
                        <group string="üí¨ Mensagens de Cobran√ßa" name="collection_messages_group">
                            <field name="collection_messages" nolabel="1" 
                                   placeholder="Adicione aqui mensagens ou notas relacionadas √† cobran√ßa desta fatura..."
                                   widget="text"/>
                        </group>
                    </page>
                </notebook>
            </field>
        </record>

    </data>
</odoo> 